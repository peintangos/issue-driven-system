---
name: test
description: "テストを実行し、結果サマリーを返す。テストログはフォークコンテキスト内に閉じ込め、メインコンテキストにはサマリーのみ返却する。"
user_invocable: true
context: fork
allowed-tools: Bash, Read
---

# テスト実行

引数に応じてテストを実行し、結果のサマリーのみを出力せよ。

## 引数の解釈

- 引数なし または `all` → 単体テスト + E2E テスト の両方を実行
- `unit` → 単体テスト（Vitest）のみ実行
- `e2e` → E2E テスト（Playwright）のみ実行

## 1. package.json の確認

プロジェクトルートの `package.json` を Read で読み込み、`scripts` セクションから以下を確認する:

- `test:unit` スクリプトの有無
- `test:e2e` スクリプトの有無

対象のスクリプトが存在しない場合は「テストスクリプトがありません」と報告して終了する。

## 2. 単体テスト実行（unit / all の場合）

`npm run test:unit` を実行する。

- 成功した場合: テスト数と成功数を記録する
- 失敗した場合: 失敗したテスト名とエラーメッセージを抽出する

## 3. E2E テスト実行（e2e / all の場合）

`npm run test:e2e` を実行する。

- 成功した場合: テスト数と成功数を記録する
- 失敗した場合: 失敗したテスト名とエラーメッセージを抽出する

## 4. サマリー出力

以下のフォーマットで結果を出力する。テストログの全文は出力しないこと。

```
## テスト結果

- 単体テスト: ✅ 成功（X件パス） / ❌ 失敗（X件パス / Y件失敗） / ⏭️ スキップ
- E2E テスト: ✅ 成功（X件パス） / ❌ 失敗（X件パス / Y件失敗） / ⏭️ スキップ

### 失敗詳細（失敗時のみ）
- `テスト名` — エラーメッセージ
```
