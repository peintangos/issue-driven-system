---
name: commit-push
description: "変更をコミットしてpushする。ユーザーがラフに「コミットして」「pushして」と言ったときに使う。"
argument-hint: "[コミットメッセージやコミット内容の説明をラフに記述]"
allowed-tools: Bash
---

ユーザーからの依頼をもとに、変更をコミットしてリモートにpushしてください。

## 手順

1. **状態の確認**: 以下を並列で実行して現状を把握する
   - `git status` で変更ファイルを確認
   - `git diff` でステージされていない変更を確認
   - `git diff --cached` でステージ済みの変更を確認
   - `git log --oneline -5` で直近のコミットスタイルを確認

2. **コミットメッセージの作成**: `$ARGUMENTS` や会話の文脈から適切なコミットメッセージを構成する
   - **Conventional Commits 形式を採用する**（例: `feat: 新機能追加`, `fix: バグ修正`, `docs: ドキュメント更新`, `chore: 雑務`）
   - ユーザーがメッセージを指定した場合はそれを尊重する
   - 指定がなければ変更内容から簡潔なメッセージを作成する

3. **ユーザーに確認**: コミット前に、内容を表示して確認を取る
   ```
   以下の内容でコミット＆pushします：

   ブランチ: [branch]
   対象ファイル:
   - [file1]
   - [file2]

   コミットメッセージ:
   [message]

   よろしいですか？
   ```

4. **コミット＆push**: 承認されたら以下を実行する
   - 対象ファイルを `git add` でステージング（`git add .` は避け、ファイル名を明示する）
   - `.env` や認証情報などの機密ファイルが含まれていないか確認する
   - `git commit` でコミット（Co-Authored-Byを付与）
   - `git push` でリモートにpush

## ルール

- ユーザーの言語に合わせる（日本語で依頼されたら日本語で）
- `.env`、認証情報、シークレットなどの機密ファイルはコミットしない。含まれていたら警告する
- `git add .` や `git add -A` は使わず、ファイルを明示的に指定する
- force pushは行わない。必要な場合はユーザーに確認する
- コミットメッセージの末尾に以下を付与する：
  ```
  Co-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>
  ```
- push後はコミットハッシュとpush先を表示する
- push先のリモートブランチが存在しない場合は `-u origin [branch]` を使う
